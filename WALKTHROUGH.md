# 简谱渲染优化指南

本文档概述了增强型简谱（numbered musical notation）渲染功能的实现详情。

## 已完成功能

### 1. 交互式播放
- **功能**: 点击简谱中的任意音符，现在可以立即跳转播放到该音符对应的时间位置。
- **视觉效果**: 音符可点击，并显示悬停效果（加粗 + 颜色变化）。

### 2. 字体实现
- **功能**: 集成 'Noto Sans SC Black'（子集化为 `JianpuDigits.woff2`）用于渲染标准简谱数字。
- **实现**: 在 `public/fonts/` 中使用本地化字体文件，并通过 CSS `@font-face` 引用。

### 3. 节奏分组（减时线/Beams）
- **功能**: 同一拍内的连续 8 分音符和 16 分音符现在会在底部以共享的减时线（横线）分组显示。
- **逻辑**: 实现了 `generateBeams` 以检测连续的短音符，并将它们合并为单条或双条下划线。

### 4. 符号增强
- **倚音 (Grace Notes)**: 增加了倚音组的渲染，包括最后一个倚音上的特征斜线（`/`）。
- **三连音 (Triplets)**: 增加了分组检测，并在音符上方渲染带有数字 "3" 的三连音括号。
- **重复线与小节线**: 改进了重复记号（`:|`、`|:`）和小节线的渲染，避免重叠。

### 5. 美学：延音线与圆滑线 (Ties and Slurs)
- **功能**: 重新设计了延音线和圆滑线，使其具有“书法风格”的新月形状。
- **实现**:
    - 将线条移动到音符**上方**。
    - 使用 SVG 填充路径代替简单的描边，以创建可变粗细（中间粗，两端尖）。
    - CSS 已更新为使用 `fill` 而非 `stroke`。

### 6. 歌词集成
- **功能**: 在音符下方显示歌词。
- **实现**: 从 ABC 源码解析歌词，并通过 `.lyric-text` 类对齐显示在对应音符下方。

## 验证步骤

1. **启动应用**:
   ```bash
   npm run dev
   ```
2. **打开乐谱**:
   - 导航到编辑器视图并打开一个简谱。
3. **测试交互**:
   - 开始播放。
   - 点击各种音符（特别是播放中间的音符）。
   - 验证音频是否立即跳转到被点击的音符。
4. **视觉检查**:
   - **字体**: 检查数字是否为粗体无衬线字体（Noto Sans 风格）。
   - **减时线 (Beams)**: 检查 8 分/16 分音符在拍内是否有连续的下划线。
   - **延音线/圆滑线**: 检查它们是否为音符上方的新月形黑色填充曲线。
   - **歌词**: 检查歌词是否出现在音符下方。
   - **倚音**: 验证小音符的尾部/符干区域是否有斜线。

## 截图

*(用于视觉验证的占位符)*
